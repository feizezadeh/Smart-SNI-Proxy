<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart SNI Proxy - Control Panel</title>
    <link rel="stylesheet" href="webpanel-style.css">
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-box">
            <div class="login-header">
                <h1>üîê Smart SNI Proxy</h1>
                <p>Control Panel Login</p>
            </div>

            <form id="loginForm">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" class="form-control" placeholder="Enter your username" required>
                </div>

                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" class="form-control" placeholder="Enter your password" required>
                </div>

                <div id="loginError" class="error-message"></div>

                <button type="submit" class="btn btn-primary btn-block">Login</button>
            </form>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="container dashboard-container">
        <!-- Header -->
        <div class="dashboard-header">
            <div class="header-left">
                <h1>üöÄ Smart SNI Proxy</h1>
                <p class="subtitle">Control Panel</p>
            </div>
            <div class="header-right">
                <span class="user-info">üë§ <span id="currentUser"></span></span>
                <button onclick="logout()" class="btn btn-secondary">Logout</button>
            </div>
        </div>

        <!-- Metrics Cards -->
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-icon">üåê</div>
                <div class="metric-content">
                    <div class="metric-label">DoH Queries</div>
                    <div class="metric-value" id="dohQueries">0</div>
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-icon">üîí</div>
                <div class="metric-content">
                    <div class="metric-label">DoT Queries</div>
                    <div class="metric-value" id="dotQueries">0</div>
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-icon">üîó</div>
                <div class="metric-content">
                    <div class="metric-label">SNI Connections</div>
                    <div class="metric-value" id="sniConnections">0</div>
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-icon">‚ö°</div>
                <div class="metric-content">
                    <div class="metric-label">Cache Hit Rate</div>
                    <div class="metric-value" id="cacheHitRate">0%</div>
                </div>
            </div>
        </div>

        <!-- Content Grid -->
        <div class="content-grid">
            <!-- Domain Management -->
            <div class="panel">
                <h2>üåç Domain Management</h2>
                <div class="panel-content">
                    <div class="input-group">
                        <input type="text" id="newDomain" class="form-control" placeholder="example.com">
                        <button onclick="addDomain()" class="btn btn-primary">Add Domain</button>
                    </div>
                    <div id="domainsList" class="domains-list"></div>
                </div>
            </div>

            <!-- System Status -->
            <div class="panel">
                <h2>üíö System Status</h2>
                <div class="panel-content">
                    <div class="status-item">
                        <span class="status-label">Version:</span>
                        <span id="systemVersion" class="status-value">-</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Uptime:</span>
                        <span id="systemUptime" class="status-value">-</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Status:</span>
                        <span id="systemStatus"><span id="systemStatusText" class="status-value">-</span></span>
                    </div>
                    <button onclick="reloadConfig()" class="btn btn-secondary btn-block">üîÑ Reload Config</button>
                </div>
            </div>

            <!-- DNS Server Info -->
            <div class="panel">
                <h2>üåê DNS Server</h2>
                <div class="panel-content">
                    <div class="status-item">
                        <span class="status-label">Standard DNS:</span>
                        <span class="status-value">89.47.113.135:53</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">DoH:</span>
                        <span class="status-value" style="font-size: 11px;">https://dns.dnsoverhttps.site/dns-query</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">DoT:</span>
                        <span class="status-value">dns.dnsoverhttps.site:853</span>
                    </div>
                    <div style="margin-top: 10px; padding: 8px; background: #e8f5e9; border-radius: 6px; text-align: center; color: #27ae60; font-size: 13px; font-weight: 500;">
                        ‚úÖ All DNS Services Active
                    </div>
                </div>
            </div>
        </div>

        <!-- User Management -->
        <div class="panel">
            <div class="panel-header-flex">
                <h2>üë• User Management</h2>
                <button onclick="showCreateUserDialog()" class="btn btn-primary">‚ûï Create New User</button>
            </div>
            <div class="panel-content">
                <div id="usersList"></div>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="panel">
            <h2>üìú Recent Activity</h2>
            <div id="logsContainer" class="logs-container">
                <div class="log-entry">Waiting for activity...</div>
            </div>
        </div>
    </div>

    <!-- Create User Dialog -->
    <div id="createUserDialog" class="dialog-overlay">
        <div class="dialog-box">
            <h2>‚ûï Create New User</h2>

            <div class="form-group">
                <label for="userName">Name</label>
                <input type="text" id="userName" class="form-control" placeholder="Enter user name" required>
            </div>

            <div class="form-group">
                <label for="userDescription">Description (Optional)</label>
                <input type="text" id="userDescription" class="form-control" placeholder="User description">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="userMaxIPs">Max IPs</label>
                    <input type="number" id="userMaxIPs" class="form-control" value="3" min="1" max="100" required>
                </div>

                <div class="form-group">
                    <label for="userValidDays">Valid Days</label>
                    <input type="number" id="userValidDays" class="form-control" value="30" min="1" max="365" required>
                </div>
            </div>

            <div class="dialog-actions">
                <button onclick="closeCreateUserDialog()" class="btn btn-secondary">Cancel</button>
                <button onclick="createUser()" class="btn btn-primary">Create User</button>
            </div>
        </div>
    </div>

    <!-- User Result Dialog -->
    <div id="userResultDialog" class="dialog-overlay">
        <div class="dialog-box">
            <h2>‚úÖ User Created Successfully!</h2>

            <div class="result-info">
                <div class="result-item">
                    <strong>Name:</strong>
                    <span id="resultUserName"></span>
                </div>
                <div class="result-item">
                    <strong>Max IPs:</strong>
                    <span id="resultUserMaxIPs"></span>
                </div>
                <div class="result-item">
                    <strong>Valid Days:</strong>
                    <span id="resultUserValidDays"></span>
                </div>
                <div class="result-item">
                    <strong>Expires:</strong>
                    <span id="resultUserExpires"></span>
                </div>
            </div>

            <div class="form-group">
                <label>Registration Link</label>
                <input type="text" id="userLinkResult" class="form-control" readonly>
                <button onclick="copyUserLink()" class="btn btn-primary btn-block">üìã Copy Link</button>
            </div>

            <div class="dialog-actions">
                <button onclick="closeUserResultDialog()" class="btn btn-secondary">Close</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="webpanel-main.js"></script>
    <script src="webpanel-enhancements.js"></script>
</body>
</html>
